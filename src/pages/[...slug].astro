---
import { loadCapturedPages } from "../lib/captured-pages";
import CapturedHtmlPage from "../components/CapturedHtmlPage.astro";

export function getStaticPaths() {
  const capturedPages = loadCapturedPages();
  const explicitRoutes = new Set(["/about-lovely-sunday"]);

  // Deduplicate by pathname â€” double-slash URLs (e.g. /lookbook//looks/x)
  // normalize to the same pathname as their single-slash counterparts.
  // Keep the last occurrence (single-slash canonical version comes after
  // double-slash in manifest order).
  const byPathname = new Map();
  for (const page of capturedPages) {
    if (page.pathname === "/") continue;
    if (explicitRoutes.has(page.pathname)) continue;
    byPathname.set(page.pathname, page);
  }

  return [...byPathname.values()].map((page) => {
    const slug = page.pathname.replace(/^\//, "");
    return {
      params: { slug },
      props: {
        rawHtml: page.rawHtml,
      },
    };
  });
}

const { rawHtml } = Astro.props;
---

<CapturedHtmlPage rawHtml={rawHtml} />
