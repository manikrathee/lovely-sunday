---
import { loadLegacyPages } from "../lib/legacy-pages";
import LegacyHtmlPage from "../components/LegacyHtmlPage.astro";

export function getStaticPaths() {
  const legacyPages = loadLegacyPages();
  const explicitRoutes = new Set(["/about-lovely-sunday"]);

  // Deduplicate by pathname â€” double-slash URLs (e.g. /lookbook//looks/x)
  // normalize to the same pathname as their single-slash counterparts.
  // Keep the last occurrence (single-slash canonical version comes after
  // double-slash in manifest order).
  const byPathname = new Map();
  for (const page of legacyPages) {
    if (page.pathname === "/") continue;
    if (explicitRoutes.has(page.pathname)) continue;
    byPathname.set(page.pathname, page);
  }

  return [...byPathname.values()].map((page) => {
    const slug = page.pathname.replace(/^\//, "");
    return {
      params: { slug },
      props: {
        rawHtml: page.rawHtml,
      },
    };
  });
}

const { rawHtml } = Astro.props;
---

<LegacyHtmlPage rawHtml={rawHtml} />
