---
import "../styles/vars.css";
import "../styles/content.css";
import "../styles/layout.css";
import "astro-breadcrumbs/breadcrumbs.css";

import { Head } from "astro-capo";
import { SEO } from "astro-seo";
import { Breadcrumbs } from "astro-breadcrumbs";
import { GoogleAnalytics } from "@astrolib/analytics";
import Header from "../components/Header.astro";
import Footer from "../components/Footer.astro";

export interface Props {
    title?: string;
    description?: string;
    noindex?: boolean;
    breadcrumbs?: boolean;
    ogImagePath?: string;
    children?: any;
}

const {
    title,
    description,
    noindex = false,
    breadcrumbs = true,
    ogImagePath,
} = Astro.props;

const siteName = "Lovely Sunday";
const siteDescription =
    "A capture-faithful recreation of Lovely Sunday in Astro.";
const normalizedPath = Astro.url.pathname.replace(/^\/|\/$/g, "");
const resolvedOgPath =
    ogImagePath || (normalizedPath.length > 0 ? normalizedPath : "index");
const canonical = Astro.url.href;
const ogImage = new URL(
    `/open-graph/${resolvedOgPath}.png`,
    Astro.site ?? Astro.url,
).href;
const gaMeasurementId = import.meta.env.PUBLIC_GA_MEASUREMENT_ID;
const twitterHandle = import.meta.env.PUBLIC_TWITTER_HANDLE;
const showBreadcrumbs = breadcrumbs && Astro.url.pathname !== "/";
---

<!doctype html>
<html lang="en">
    <Head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width" />
        <meta name="generator" content={Astro.generator} />
        <link rel="icon" type="image/svg+xml" href="/favicon.svg" />

        <SEO
            title={title || siteName}
            titleDefault={siteName}
            titleTemplate={`%s | ${siteName}`}
            description={description || siteDescription}
            canonical={canonical}
            noindex={noindex}
            nofollow={noindex}
            openGraph={{
                basic: {
                    title: title || siteName,
                    type: "website",
                    image: ogImage,
                    url: canonical,
                },
                optional: {
                    description: description || siteDescription,
                    siteName,
                },
            }}
            twitter={{
                card: "summary_large_image",
                title: title || siteName,
                description: description || siteDescription,
                image: ogImage,
                creator: twitterHandle || undefined,
                site: twitterHandle || undefined,
            }}
        />
    </Head>
    <body class="site-wrapper">
        <Header title={title} />

        {showBreadcrumbs && (
            <div class="site-breadcrumbs">
                <Breadcrumbs indexText="Home" />
            </div>
        )}

        <main id="site-main" class="site-main">
            <div id="swup" class="transition-fade">
                <slot />
            </div>
        </main>

        <Footer />

        <script>
            import Swup from "swup";
            import HeadPlugin from "@swup/head-plugin";

            document.addEventListener("DOMContentLoaded", () => {
                new Swup({
                    containers: ["#swup"],
                    cache: true,
                    animationSelector: "[class*='transition-']",
                    plugins: [new HeadPlugin()],
                });
            });
        </script>

        {gaMeasurementId && <GoogleAnalytics id={gaMeasurementId} />}
    </body>
</html>
